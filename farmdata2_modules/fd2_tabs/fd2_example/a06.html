<html>
        <body> 
             <div id='a04ex' v-cloak>
         
            <h1>Harvest Report</h1>
            
            <p>This page is a  <i>mockup</i> of a form for generating a harvest report. </p>
            <label for = "title"> Title: </label> 
            <input type="text" id="title" value="title" v-model="Title"> 
            
            <br>
            
            <label for="start">Start:</label>

            <input type="date" id="start" name="start" v-model="StartDate" min="2014-01-01" :max="EndDate">
            
            <label for="end">End:</label>
            
            <input type="date" id="end" name="end" v-model="EndDate" :min="StartDate" max="2022-01-01">
            
            <br>
            
            <label for="crop">Crop: </label>
            
            <select id="crop" name="crop" v-model="reportCrop">
                <ul>
                    <option v-for='crop in crops'>{{ crop }}</option>
                </ul>
            </select>

		    <label for="field">Field: </label>
		        <select id="field" name="field">
                    <ul>
                        <option v-for='field in fields'>{{ field }}</option>
                    </ul>
		        </select>
        
            <br> 
            
            <button type="button" class="btn btn-primary" @click="generateButton" id="generateReport">Generate Report</button>
        
            <hr>
            <div v-if="state=='visible'">
            <h1>{{ Title ? Title : "Mock Harvest Report" }}</h1>
        
		    <p>Details:</p>

		    <ul>
			    <li><strong>Start:</strong>{{ StartDate }}</li>
			    <li><strong>End:</strong>{{ EndDate }}</li>
                <li><strong>Crop:</strong>{{ reportCrop }}</li>
            </ul>
            <p v-if="harvestLogs.length == 0">No records match the search.</p>
		    <br>
        
            <table border=1 v-else>
		    <tr>
			    <th>Date</th>
			    <th>Field</th>
			    <th>Crop</th>
			    <th>Yield</th>
		    </tr>
        
            <tr v-for='(harvestLog,index) in harvestLogs'>
                <td>{{ harvestLog.Date }}</td>
                <td>{{ harvestLog.Field }}</td>
                <td>{{ harvestLog.Crop }}</td>
                <td>{{ harvestLog.Yield }}</td>
		<td><button type="button" @click="deleteLog(index)">Delete</button></td>
		    </tr>
            </table> 
            <p> Total Yield: {{ totalYield }} Bunches </p>
            </div>

            </div>

	    <script>
		var a04vue = new Vue({
			el: '#a04ex',
			data: {
				Title: '',
                StartDate: '',
				EndDate: '',
                reportCrop: '',
                state:'inVisible',
                crops: [ 'Broccoli', 'Kale', 'Peas' ],
                fields: [ 'All', 'Chuau-1', 'SQ7' ],
                harvestLogs: [],
		        Log:[ {Date: '05/02/2018', Field: 'SQ7', Crop: 'Kale', Yield: '10 Bunches'},
		        {Date: '09/02/2018', Field: 'All', Crop: 'Brocoli', Yield: '7 Bunches'},
		        {Date: '11/02/2018', Field: 'SQ7', Crop: 'Peas', Yield: '10 Bunches'}
		        ]			
            },
		    methods:{
			    generateButton: function(){
				    axios.get('/log.json?type=farm_harvest&area=jasmine-1')
                .then(response => {
            this.harvestLog = response.data.list.map(h =>{
                return{
                    Date:h.timestamp,
                    Field: 'blah',
                    Crop:'blah',
                    Yield:'blah',
                };
                },
                deleteLog: function(index){
                    this.harvestLogs.splice(index,1);
                }
            },
            computed:{
                totalYield: function(){
                    var total = 0;
                    for (let i=0; i<this.harvestLogs.length; i=i++) {
                        let yield = parseInt(this.harvestLogs[i].Yield.split(" ")[0]);
                        total = total + yield;
                    }
                    return total;
                }
            },

            created(){
            axios.get('/taxonomy_term.json?area_type=field')
                .then(response => {
            this.fields = response.data.list.map(f => f.name).sort();
            })
            axios.get('/farm_asset.json?type=planting')
                .then(response => {
            this.crops = response.data.list.map(f => f.name).sort();
            })

        },
        });
        Vue.config.devtools = true;
        </script>
        
    </body>
</html>
